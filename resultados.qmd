
# Resultados

## Análise Exploratória

Nesta seção, foi feita uma análise exploratória dos dados, é uma etapa essencial para compreender e interpretar. Foram feitas análises gráficas e de medidas resumo das 11 variáveis do banco de dados, com o objetivo de visualizar individualmente, compreender melhor os dados, verificar as possíveis hipóteses para o problema e verificar relação entre elas.

![](Tabela%20dados.png)

```{r}
library(dplyr)
library(ggplot2)
library(pacman)
pacman::p_load(openxlsx,
               tidyverse,
               ggpubr,
               car,
               kableExtra,
               e1071,
               patchwork)
library(readxl)
dados <- read_excel("dados_60.xlsx")
banco <- read_excel("dados/Dados_trabalho_20232.xlsx")


# > 3.1 Boxplots e histogramas ####

# > 3.1.1 Duração da internação ####

box1<- ggplot(dados, aes(x=factor(""),y=(t_internacao)))+
  geom_boxplot(fill=c("#8494FF"), width=.5)+
  guides(fill='none')+
  stat_summary(fun = "mean", geom = "point", shape = 23, size=3, fill="white")+
  labs(x="",y="Duração da Internação")+
  theme_bw()+
  theme(axis.title.y = element_text(color = "black", size=9),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

hist1<-ggplot(dados, aes(x=t_internacao))+
  geom_histogram(color="white", fill = "#8494FF")+
  labs(x= "Duração da Internação \n(Dias)", y= "Frequência absoluta")+
  theme_bw()+
  scale_y_continuous(breaks = seq(0,10), limits = c(0,10))+
  theme(axis.title.y = element_text(color = "black", size=10),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

# > 3.1.2 Idade ####

box2<- ggplot(dados, aes(x=factor(""),y=(idade)))+
  geom_boxplot(fill=c("#8494FF"), width=.5)+
  guides(fill='none')+
  stat_summary(fun = "mean", geom = "point", shape = 23, size=3, fill="white")+
  labs(x="",y="Idade dos Pacientes")+
  theme_bw()+
  theme(axis.title.y = element_text(color = "black", size=9),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

hist2<- ggplot(dados, aes(x=idade))+
  geom_histogram(color="white", fill = "#8494FF")+
  labs(x= "Idade dos Pacientes", y= "Frequência absoluta")+
  theme_bw()+
  scale_y_continuous(breaks = seq(0,10), limits = c(0,10))+
  theme(axis.title.y = element_text(color = "black", size=10),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

# > 3.1.3 Risco de Infecção ####

box3<- ggplot(dados, aes(x=factor(""),y=(r_infeccao)))+
  geom_boxplot(fill=c("#8494FF"), width=.5)+
  guides(fill='none')+
  stat_summary(fun = "mean", geom = "point", shape = 23, size=3, fill="white")+
  labs(x="",y="Risco de Infecção (%)")+
  theme_bw()+
  theme(axis.title.y = element_text(color = "black", size=9),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

hist3<- ggplot(dados, aes(x=r_infeccao))+
  geom_histogram(color="white", fill = "#8494FF")+
  labs(x= "Risco de Infecção (%)", y= "Frequência absoluta")+
  theme_bw()+
  scale_y_continuous(breaks = seq(0,10), limits = c(0,10))+
  theme(axis.title.y = element_text(color = "black", size=10),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

# > 3.1.4 Prop de Culturas de Rotina ####

box4<- ggplot(dados, aes(x=factor(""),y=(prop_culturas)))+
  geom_boxplot(fill=c("#8494FF"), width=.5)+
  guides(fill='none')+
  stat_summary(fun = "mean", geom = "point", shape = 23, size=3, fill="white")+
  labs(x="",y="Prop de Culturas de Rotina")+
  theme_bw()+
  theme(axis.title.y = element_text(color = "black", size=9),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

hist4<- ggplot(dados, aes(x= prop_culturas))+
  geom_histogram(color="white", fill = "#8494FF")+
  labs(x= "Proporção de Culturas \nde Rotina", y= "Frequência absoluta")+
  theme_bw()+
  scale_y_continuous(breaks = seq(0,10), limits = c(0,10))+
  theme(axis.title.y = element_text(color = "black", size=10),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

# > 3.1.5 Prop de Raio-X de Toráx de Rotina ####

box5<- ggplot(dados, aes(x=factor(""),y=(prop_raiox)))+
  geom_boxplot(fill=c("#8494FF"), width=.5)+
  guides(fill='none')+
  stat_summary(fun = "mean", geom = "point", shape = 23, size=3, fill="white")+
  labs(x="",y="Prop de Raio-X de Tórax")+
  theme_bw()+
  theme(axis.title.y = element_text(color = "black", size=9),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

hist5<- ggplot(dados, aes(x= prop_raiox))+
  geom_histogram(color="white", fill = "#8494FF")+
  labs(x= "Proporção de Raio-X \nde Tórax", y= "Frequência absoluta")+
  theme_bw()+
  scale_y_continuous(breaks = seq(0,10), limits = c(0,10))+
  theme(axis.title.y = element_text(color = "black", size=10),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

# > 3.1.6 Número de Leitos ####

box6<- ggplot(dados, aes(x=factor(""),y=(leitos)))+
  geom_boxplot(fill=c("#8494FF"), width=.5)+
  guides(fill='none')+
  stat_summary(fun = "mean", geom = "point", shape = 23, size=3, fill="white")+
  labs(x="",y="Número de Leitos")+
  theme_bw()+
  theme(axis.title.y = element_text(color = "black", size=9),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

hist6<- ggplot(dados, aes(x= leitos))+
  geom_histogram(color="white", fill = "#8494FF")+
  labs(x= "Número de Leitos", y= "Frequência absoluta")+
  theme_bw()+
  scale_y_continuous(breaks = seq(0,10), limits = c(0,10))+
  theme(axis.title.y = element_text(color = "black", size=10),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

# > 3.1.7 Filiação a Escola de Medicina (quali) ####

em<- dados %>% select(escola_medicina) %>%
  mutate("escmed" = ifelse(escola_medicina == 1, "Sim","Não"))

hist7<- ggplot(em, aes(x=factor(escmed, levels= c("Sim","Não"))))+
  geom_bar(fill = "#8489FF")+
  labs(x= "Filiação a Escola\n de Medicina", y= "Frequência absoluta")+
  theme_bw()+
  theme(axis.title.y = element_text(color = "black", size=10),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=11),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

# > 3.1.8 Região (quali) ####

regg<- dados %>% select(regiao) %>%
  mutate("reg" = case_when(regiao == 1 ~ "NE",
                           regiao== 2 ~ "NC",
                           regiao== 3 ~ "S",
                           regiao== 4~ "W"))

hist8<- ggplot(regg, aes(x=factor(reg, levels= c("NE","NC","S","W"))))+
  geom_bar(fill = "#8489FF")+
  labs(x= "Região", y= "Frequência absoluta")+
  theme_bw()+
  scale_y_continuous(limits = c(0,20))+
  theme(axis.title.y = element_text(color = "black", size=10),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=11),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

# > 3.1.9 Média diária de Pacientes ####

box9<- ggplot(dados, aes(x=factor(""),y=(m_dia_pacientes)))+
  geom_boxplot(fill=c("#8494FF"), width=.5)+
  guides(fill='none')+
  stat_summary(fun = "mean", geom = "point", shape = 23, size=3, fill="white")+
  labs(x="",y="Média diária de pacientes")+
  theme_bw()+
  theme(axis.title.y = element_text(color = "black", size=9),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

hist9<- ggplot(dados, aes(x= m_dia_pacientes))+
  geom_histogram(color="white", fill = "#8494FF")+
  labs(x= "Média diária \nde pacientes", y= "Frequência absoluta")+
  theme_bw()+
  scale_y_continuous(breaks = seq(0,10), limits = c(0,10))+
  theme(axis.title.y = element_text(color = "black", size=10),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

# > 3.1.10 Número de Enfermeiros ####

box10<- ggplot(dados, aes(x=factor(""),y=(enfermeiros)))+
  geom_boxplot(fill=c("#8494FF"), width=.5)+
  guides(fill='none')+
  stat_summary(fun = "mean", geom = "point", shape = 23, size=3, fill="white")+
  labs(x="",y="Número de \nEnfermeiro(s)")+
  theme_bw()+
  theme(axis.title.y = element_text(color = "black", size=9),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

hist10<- ggplot(dados, aes(x= enfermeiros))+
  geom_histogram(color="white", fill = "#8494FF")+
  labs(x= "Número de \nEnfermeiro(s)", y= "Frequência absoluta")+
  theme_bw()+
  scale_y_continuous(breaks = seq(0,10), limits = c(0,10))+
  theme(axis.title.y = element_text(color = "black", size=10),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

# > 3.1.11 Facilidades e Serviços disponíveis ####

box11<- ggplot(dados, aes(x=factor(""),y=(facilidades_servicos)))+
  geom_boxplot(fill=c("#8494FF"), width=.5)+
  guides(fill='none')+
  stat_summary(fun = "mean", geom = "point", shape = 23, size=3, fill="white")+
  labs(x="",y="Facilidades e Serviços \n disponíveis")+
  theme_bw()+
  theme(axis.title.y = element_text(color = "black", size=9),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))

hist11<- ggplot(dados, aes(x= facilidades_servicos))+
  geom_histogram(color="white", fill = "#8494FF")+
  labs(x= str_wrap("Facilidades e Serviços disponíveis", width = 20) , y= "Frequência absoluta")+
  theme_bw()+
  scale_y_continuous(breaks = seq(0,10), limits = c(0,10))+
  theme(axis.title.y = element_text(color = "black", size=10),
        axis.title.x = element_text(color="black", size = 10),
        axis.text = element_text(color = "#000000", size=9.5),
        panel.border = element_blank(),
        axis.line.y = element_line(color="black"))
```

```{r}
#| fig-height: 7
#| label: fig-boxplot
#| fig-cap: Boxplots e das variáveis quantitativas.

# > Juntando os boxplots e histogramas ####

ggarrange(box1, box2, box3,
          box4, box5, box6, box9, box10, box11,
          nrow = 3, ncol = 3)

```

```{r}
#| fig-height: 7
#| label: fig-hist
#| fig-cap: Histogramas das variáveis quantitativas.

# > Juntando os boxplots e histogramas ####

ggarrange(hist1, hist2, hist3, hist4,
          hist5, hist6, hist9, hist10, hist11,
          nrow=3, ncol=3)

```


```{r}
#| eval: false
# > 3.2 Tabelas de Frequência quanti ####

# > 3.2.1 Duração da internação ####

summary(dados$t_internacao)
sd(dados$t_internacao)

# > 3.2.2 Idade ####

summary(dados$idade)
sd(dados$idade)

# > 3.2.3 Risco de Infecção ####

summary(dados$r_infeccao)
sd(dados$r_infeccao)

# > 3.2.4 Prop de Culturas de Rotina ####

summary(dados$prop_culturas)
sd(dados$prop_culturas)

# > 3.2.5 Prop de Raio-X de Toráx de Rotina ####

summary(dados$prop_raiox)
sd(dados$prop_raiox)

# > 3.2.6 Número de Leitos ####

summary(dados$leitos)
sd(dados$leitos)

# > 3.2.9 Média diária de Pacientes ####

summary(dados$m_dia_pacientes)
sd(dados$m_dia_pacientes)

# > 3.2.10 Número de Enfermeiros ####

summary(dados$enfermeiros)
sd(dados$enfermeiros)

# > 3.2.11 Facilidades e Serviços disponíveis ####

summary(dados$facilidades_servicos)
sd(dados$facilidades_servicos)
```

![](Tabela-quati.png){label="Tabela-quanti"}


No banco de dados, existem 11 variáveis, das quais 9 são quantitativas, dentre elas, duração da internação, idade, risco de infecção, proporção de culturas de rotina, proporção de raio-x de tórax de rotina, facilidades e serviços disponíveis são contínuas e leitos, média de pacientes e enfermeiros são discretas. Completando a quantidade de variáveis, filiação a escola de medicina e região, que são qualitativas nominais.

Ao analisar o nosso gráfico de boxplot ([Figura @fig-boxplot]), percebe-se a existência de valores que se diferenciam drasticamente da normalidade (*outliers*), mas eles não são semelhantes para todas as variáveis. Em alguns casos, como idade de pacientes e risco de infecção, eles aparecem tanto abaixo como acima do esperado. Em outros casos, como proporção de raio-x de tórax e facilidades e serviços disponíveis, não há valores discrepantes. E em sua maioria existem *outliers* que estão acima do limite superior.

Observando então a [Figura @fig-hist], percebe-se que a influência dos *outliers* é significativa, dado que, nas variáveis que possuem apenas valores acima do limite superior, é visível uma assimetria positiva a direita. Já as que possuem acima do limite superior e abaixo do inferior, e as que não se observa *outliers*, são um pouco mais simétricas. Essa condição que afeta diretamente também nos valores de média e desvio padrão.


Observando as variáveis qualitativas, temos como característica, que todas são nominais. No histograma ([Figura @fig-hist-discretas]), temos que a maioria não possui filiação com escola de medicina, observação que é confirmada através da Tabela 3, já que, 81,67% diz não ter.


```{r}
#| label: fig-hist-discretas
#| fig-cap: Histogramas das variáveis discretas.

# > Juntando os boxplots e histogramas ####

ggarrange(hist7, hist8,
          nrow=1, ncol=2)

```


![](Tabela-quali.png){.unnumbered #fig:tabela3 width="429" caption="Tabela 3"}

```{r}
#| eval: false
# > 3.2 Tabelas de Frequência quali ####

# > 3.2.7 Filiação a Escola de Medicina (quali) ####

dados %>% select(escola_medicina) %>%
  mutate("escmed" = ifelse(escola_medicina == 1, "Sim","Não")) %>%
  group_by(escola_medicina) %>% 
  summarise(freq=n()) |> 
  kbl(format = "latex") %>% 
  kable_styling(latex_options = "striped")

# > 3.2.8 Região (quali) ####

dados %>% select(regiao) %>%
  mutate("reg" = case_when(regiao == 1 ~ "NE",
                           regiao== 2 ~ "NC",
                           regiao== 3 ~ "S",
                           regiao== 4~ "W")) %>%
  group_by(regiao)%>% summarise(freq= n())


```


E, para a variável região, existe uma maior frequência nas regiões NE, NC e S do que na região W. Observação que é ressaltada na Tabela 3, já que somente 13,34% se encontra na região W, dividindo então, com valores bem parecidos para o restante das regiões.























## Modelo Completo e Seleção de Variáveis

Nesta etapa da pesquisa, realizou-se a análise preliminar das variáveis em estudo e a construção do modelo de regressão linear múltipla para investigar os fatores associados à duração da internação hospitalar. A abordagem foi enriquecida pela exploração de relações de segunda ordem, com foco específico na influência do número de enfermeiros(as) nas instalações e serviços disponíveis. Além disso, foram incorporadas variáveis regionais para examinar possíveis variações geográficas na duração da internação. Essa abordagem permite uma compreensão mais abrangente dos fatores que contribuem para a complexidade do tempo de internação hospitalar, considerando não apenas características individuais do paciente, mas também aspectos relacionados ao tratamento e ao contexto hospitalar.

Na avaliação das correlações entre variáveis quantitativas, foram observadas associações positivas e significativas entre a duração da internação e variáveis como risco de infecção, número de leitos, média diária de pacientes, quantidade de enfermeiros(as) e a disponibilidade de facilidades e serviços hospitalares. Essas correlações sugerem a possível influência dessas variáveis na variabilidade da duração da internação, como se pode ver na Figura [Figura @fig-corr-graph].

```{r}
pacman::p_load(openxlsx,
               tidyverse,
               ggpubr,
               car,
               e1071,
               leaps,
               MASS,
               gtsummary,
               stargazer,
               GGally,
               lmtest)


options(scipen = 999)

base <- readxl::read_xlsx("dados_60.xlsx")

# Correlações----
#base para correlações  variáveis quantitativas
base_corr <-
  base[, c(
    "t_internacao",
    "idade",
    "r_infeccao",
    "prop_culturas",
    "prop_raiox",
    "leitos",
    "m_dia_pacientes",
    "enfermeiros",
    "facilidades_servicos"
  )]


correl <- cor(base_corr)
# grafico das correlações----
# nome das variáveis para o gráfico


nomes_variaveis <-
  c(
    "Tempo\nde\nInternação",
    "Idade",
    "Risco de\nInfecção",
    "Proporção\nde Culturas",
    "Proporção\nde Raio-X",
    "Leitos",
    "Média Diária\nde Pacientes",
    "Enfermeiros",
    "Facilidades\nde Serviços"
  )

colnames(base) <- nomes_variaveis

panel.cor <- function(x,
                      y,
                      digits = 3,
                      prefix = "",
                      cex.cor = 1.5)
{
  par(usr = c(0, 1, 0, 1))
  r <- abs(cor(x, y))
  txt <- format(c(r, 0.123456789), digits = digits)[1]
  txt <- paste0(prefix, txt)
  text(0.5, 0.5, txt, cex = cex.cor)
}

cex.labels <- 0.9
```


```{r}
#| fig-height: 7
#| fig-width: 7
#| fig-cap: Correlações entre as variáveis quantitativas.
#| label: fig-corr-graph

pairs(
  base_corr,
  lower.panel = panel.smooth,
  upper.panel = panel.cor,
  gap = 0,
  row1attop = FALSE,
  cex.labels = cex.labels,
  labels = nomes_variaveis
)

base <- readxl::read_xlsx("dados_60.xlsx")



```

Ao explorar a relação entre a idade média dos pacientes e o tempo internação, foi observada uma associação modesta de 0,187, o que sugere, em geral, que pacientes mais idosos podem demandar internações mais prolongadas. O risco de infecção mostrou uma correlação substancial (0,632), o que indica que hospitais com maiores índices de risco infeccioso podem enfrentar internações mais extensas. A análise das proporções de culturas de rotina (0,314) e Raio-X de Tórax de rotina (0,389) revelou associações interessantes. Hospitais que realizam mais culturas de rotina e exames de Raio-X de Tórax de rotina parecem enfrentar internações mais longas, o que sugere uma possível relação entre a extensão das investigações diagnósticas e a duração do tratamento.

Destaca-se que a disponibilidade de leitos, o número de enfermeiros(as) e o percentual de facilidades e serviços apresentaram correlações positivas e consistentes (de 0,405, 0,379 e 0,513 respectivamente) com a duração da internação. Esses resultados ressaltam a importância crítica desses fatores na gestão eficaz do tempo de internação, evidenciando a necessidade de estruturas hospitalares adequadas e recursos humanos suficientes. Além disso, a média diária de pacientes apresentou uma correlação positiva de 0,451 com o tempo de internação, o que indica um aumento no tempo das internações em hospitais que apresentam maior demanda diária.

```{r}
#| output: false


# Modeloss ----

# nova base para correção das categorias das v.a's qualitativas
base_new <- base

#View(base_new)
# Corrigir as categorias da variável escola_medicina
base_new <- 
  base_new |> 
  mutate(escola_medicina = factor(base$escola_medicina, levels = c(1, 2), labels = c("Sim", "Não")))


# Corrigir as categorias da variável regiao
base_new$regiao <- factor(base$regiao, levels = c(1, 2, 3, 4), labels = c("NE", "NC", "S", "W"))

# Modelo linear múltiplo completo----
completo_mod <- lm(t_internacao ~ idade + r_infeccao + prop_culturas + prop_raiox +
                     leitos + escola_medicina + regiao + m_dia_pacientes + enfermeiros + 
                     facilidades_servicos, data = base_new)

#summary(completo_mod)
#coef(completo_mod)

# Modelo com interação entre número de enfermeiros e região-----
modelo_interacao <- lm(t_internacao ~ idade + r_infeccao + prop_culturas + prop_raiox +
                         leitos + escola_medicina + regiao + m_dia_pacientes + enfermeiros + 
                         facilidades_servicos + enfermeiros * regiao, data = base_new)


#summary(modelo_interacao)


# Modelo de segunda ordem----

# Modelo de segunda ordem
completo_mod_segunda_ordem <- lm(t_internacao ~ idade + r_infeccao + prop_culturas + prop_raiox +
                     leitos + escola_medicina + regiao + m_dia_pacientes + enfermeiros + 
                     facilidades_servicos + I(enfermeiros^2) + 
                     I(facilidades_servicos^2), data = base_new)

#summary(completo_mod_segunda_ordem)
#--------------------------------------------------------------------------p

# Modelo combinado com interação e termos de segunda ordem----
modelo_combinado <- lm(t_internacao ~ idade + r_infeccao + prop_culturas + prop_raiox +
                         leitos + escola_medicina + regiao + m_dia_pacientes + enfermeiros + 
                         facilidades_servicos + enfermeiros * regiao + I(enfermeiros^2) + 
                         I(facilidades_servicos^2), data = base_new)

  # Recupera os p-valores
p_values_modelo_original <- summary(completo_mod)$coefficients
p_values <- summary(modelo_combinado)$coefficients


```


```{r}
#| output: asis
#| label: tbl-reg-modelo-combinado
#| tbl-cap: Modelo de regressão linear múltipla com interação e termos de segunda ordem.

stargazer(completo_mod,
          modelo_combinado,
          column.labels=c("Modelo simples","Modelo segunda \n ordem e interações"),
          model.numbers = FALSE,
          single.row=TRUE,
          report=("vc*p"),
          header = FALSE
          )

```

Ao considerar a influência de variáveis relacionadas ao paciente, tratamento e hospital na duração da internação, o modelo de regressão linear múltipla fornece insights valiosos, que podem ser vistos na [Tabela @tbl-reg-modelo-combinado]. Esse modelo, embora seja mais simples por não incorporar interações ou termos de segunda ordem, é notável em sua capacidade de explicar `r format(round(summary(completo_mod)$r.squared * 100, digits = 2), decimal.mark = ",")`% da variação na duração da internação. Isso sugere que, mesmo sem levar em conta complexidades adicionais nas relações entre as variáveis, as características básicas do paciente, seu tratamento e o ambiente hospitalar desempenham um papel crucial na determinação da duração da internação.

\begin{equation}
\begin{split}
Y_i = & \beta_0 + \beta_1 X_{1i} + \beta_2 X_{2i} + \beta_3 X_{3i} + \beta_4 X_{4i} + \beta_5 X_{5i} + \beta_6 X_{6i} + \beta_7 X_{7i} + \beta_8 X_{8i} \\
&+ \beta_9 X_{9i}  + \beta_{10} X_{10i} + \beta_{11} X_{11i} + \beta_{11,11} X_{11i}^{2} + \beta_{12} X_{12i} + \beta_{12,12} X_{12i}^{2} \\
& + \beta_{7,12} X_{7i}X_{12i} + \beta_{8,12} X_{8i}X_{12i} + \beta_{9,12} X_{9i}X_{12i} + \varepsilon_i
\end{split}
\end{equation}

O modelo inicial ressalta a relevância de certas variáveis na explicação da duração da internação. Por exemplo, o coeficiente associado à idade não é estatisticamente significativo (p-valor: `r format(round(p_values_modelo_original["idade", 4], digits = 4), decimal.mark = ",")`), sugerindo que a idade média dos pacientes não está fortemente associada à duração da internação.

Em contrapartida, o coeficiente para o Risco de Infecção é estatisticamente significativo (p-valor: `r format(round(p_values_modelo_original["r_infeccao", 4], digits = 6), decimal.mark = ",")`), indicando que um aumento no risco de infecção está associado a um aumento na duração da internação. Além disso, os coeficientes negativos para as Regiões (regiaoNC, regiaoS, regiaoW) indicam que essas regiões têm internações mais curtas em comparação com a região NE. As demais variáveis do modelo não apresentam significância estatística uniforme, ressaltando a importância de variáveis específicas, como o Risco de Infecção, na explicação da variação na duração da internação.

Considerando a complexidade das relações entre variáveis, foi incorporarado ao modelo interacões e termos de segunda ordem. Essa abordagem visa explorar nuances que podem ser negligenciadas em um modelo linear. 


O termo quadrático para o número de enfermeiros $(X_{11i}^{2})$ apresenta um coeficiente negativo, sugerindo a possibilidade de saturação no impacto positivo do aumento no número de enfermeiros, indicando que, após um certo ponto, um aumento adicional pode não ter o mesmo efeito positivo na redução da duração da internação. Por outro lado, o termo quadrático para facilidades e servicos disponíveis $(X_{12i}^{2})$ não demonstra significância estatística (p-valor: `r format(round(p_values["I(facilidades_servicos^2)", 4], digits = 4), decimal.mark = ",")`), sugerindo que a relação quadrática entre essa variável e a duração da internação não é estatisticamente robusta.

Na avaliação global do modelo, o coeficiente de determinação $(R^{2})$ de `r format(round(summary(modelo_combinado)$r.squared, digits = 4), decimal.mark = ",")` destaca sua eficácia ao explicar aproximadamente `r format(round(summary(modelo_combinado)$r.squared * 100, digits = 2), decimal.mark = ",")`% da variabilidade na duração da internação, evidenciando sua robusta capacidade preditiva. No âmbito específico do modelo, destaca-se que o risco de infecção apresenta uma associação positiva e estatisticamente significativa (coeficiente: `r format(round(p_values["r_infeccao", 1], digits = 3), decimal.mark = ",")`, p-valor: `r format(round(p_values["r_infeccao", 4], digits = 4), decimal.mark = ",")`) com a duração da internação. Essa constatação sugere que um aumento no risco de infecção está relacionado a um período mais longo de internação.

Em contraste, variáveis como idade e filiação a escola de medicina não apresentaram significância estatística, indicando que a idade média dos pacientes e a vinculação à escola de medicina não estão fortemente associadas à duração da internação. Além disso, outras variáveis, como proporção de culturas, leitos e facilidades e servicos diponíveis, também não apresentaram significância estatística uniforme, sugerindo que sua inclusão no modelo pode não contribuir significativamente para explicar a variabilidade observada na duração da internação.

Entretanto, surge a necessidade de uma análise mais profunda para assegurar a robustez do modelo. Questões sobre a presença de multicolinearidade entre as variáveis independentes são pertinentes, considerando o potencial impacto na precisão das estimativas. Como dito, a multicolinearidade, oriunda da alta correlação entre variáveis independentes, pode dificultar a identificação de seus efeitos individuais, comprometendo a interpretação dos resultados.

Dessa forma, a etapa seguinte compreenderá a condução de diagnósticos específicos para avaliar a multicolinearidade e, se necessário, efetuar ajustes no modelo. Paralelamente, serão realizadas análises dos pressupostos da regressão linear múltipla, tais como a normalidade dos resíduos, homocedasticidade e independência, visando garantir a validade das inferências.

Continuando a análise do modelo combinado, foram realizados testes importantes para verificar a adequação dos resíduos ao pressuposto da normalidade e homocedasticidade.


```{r}
# PRESSUPOSTOS------
# Normalidade------

shapiro <- shapiro.test(modelo_combinado$residuals)

durbin_watson <- durbinWatsonTest(modelo_combinado)

```




```{r}
#| label: fig-qqplot
#| fig-cap: Gráfico de distribuição normal dos resíduos

#g´rfico----
qqplot.data <- function (vec, nome){
  # following four lines from base R's qqline()
  y <- quantile(vec[!is.na(vec)], c(0.25, 0.75))
  x <- qnorm(c(0.25, 0.75))
  slope <- diff(y)/diff(x)
  int <- y[1L] - slope * x[1L]
  
  d <- data.frame(resids = vec)
  
  ggplot(d, aes(sample = resids, color = "#4A7B7E")) + stat_qq() + geom_abline(slope = slope, 
                                                                               intercept = int) +
    theme_bw() + labs(y=nome, x="Quantil teórico") + 
    theme(axis.title.y=element_text(colour="black", size=12),
          axis.title.x = element_text(colour="black", size=12),
          axis.text = element_text(colour = "black", size=9.5),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black"),
          legend.position="none") + scale_color_manual(values = c("#4A7B7E"))
  
}
qqplot.data(modelo_combinado$residuals, "Resíduos")

# Homocedascidade----
BP <- bptest(modelo_combinado)

#independencia-----
# residuos studentzados 
stud0<-rstudent(modelo_combinado) 



```

O teste de normalidade de Shapiro-Wilk foi aplicado aos resíduos do modelo combinado, resultando em uma estatística W de `r format(round(shapiro$statistic, digits = 4), decimal.mark = ",")` e um p-valor de `r format(round(shapiro$p.value, digits = 4), decimal.mark = ",")`. O valor de W próximo a 1 e o p-valor superior a 0.05 sugerem que não há evidências suficientes para rejeitar a hipótese nula de normalidade dos resíduos. Conclusão semelhante pode ser identificada na [Figura @fig-qqplot]. Assim, os resíduos do modelo parecem seguir uma distribuição normal.

Além disso, foi realizado o teste de Breusch-Pagan para avaliar a homocedasticidade dos resíduos. O teste resultou em uma estatística BP de `r format(round(BP$statistic, digits = 4), decimal.mark = ",")`, com 17 graus de liberdade e um p-valor de `r format(round(BP$p.value, digits = 4), decimal.mark = ",")`. O p-valor maior que 0.05 indica que não há evidências significativas para rejeitar a hipótese nula de homocedasticidade. Portanto, os resíduos parecem exibir homocedasticidade, indicando que a variância dos erros é constante em diferentes níveis de preditores.





```{r}
#| fig-cap: Gráfico de Resíduos e Resíduos Studentizados vs Valores Ajustados.
#| label: fig-residuos


par(mfrow = c(1, 2))

# Gráfico de Resíduos
plot(
  modelo_combinado$fitted.values,
  modelo_combinado$residuals,
  xlab = "Valores ajustados",
  ylab = "Resíduos"
)
#title("Gráfico de Resíduos do Modelo")

# Gráfico de Resíduo Studentizado
plot(modelo_combinado$fitted.values,
     stud0,
     xlab = "Valores ajustados",
     ylab = "Resíduo Studentizado")
#abline(h = 0)
#title("Gráfico de Resíduo Studentizado do Modelo")
```

A análise da [Figura @fig-residuos]  reforça que a independência dos resíduos foi atendida, consolidando a confiabilidade dos resultados obtidos no modelo. Além disso, o teste de Durbin-Watson para independência também não rejeitou a hipótese nula de independência, com p-valor de `r format(round(durbin_watson$p, digits = 4), decimal.mark = ",")`. A confirmação da normalidade, homocedasticidade e independência dos resíduos fortalece a robustez do modelo, oferecendo suporte à validade das inferências derivadas.

### Seleção de Variáveis

Na presente seção, a análise das variáveis do modelo será aprofundada, visando à seleção criteriosa do modelo reduzido que melhor se adequa à explicação do tempo de internação. Métodos de seleção de variáveis serão utilizados com o intuito de assegurar uma abordagem mais precisa e refinada na identificação dos fatores mais relevantes para o tempo de internação.



![](variaveis.png){height="350"}

![](tabela_modelos.png)

```{r}
#| output: false

# seleção de variáveis

# stepwise
stepwise_modelo <- step(modelo_combinado, direction = "both")
summary(stepwise_modelo) #t_internacao ∼ r_infeccao+prop_culturas+leitos+escola_medicina+regiao AIC= 7.71


#forward
forward_modelo <- step(modelo_combinado, direction = "forward")
summary(forward_modelo)

#backward
backward_modelo <- step(modelo_combinado, direction = "backward") # AIC=7.71; t_internacao ~ r_infeccao + prop_culturas + leitos + escola_medicina + regiao
summary(backward_modelo)


# Realize a busca exaustiva
subset_modelo <- regsubsets(t_internacao ~ idade + r_infeccao + prop_culturas + prop_raiox +
                              leitos + escola_medicina + regiao + m_dia_pacientes + enfermeiros + 
                              facilidades_servicos + enfermeiros * regiao + 
                              I(enfermeiros^2) + I(facilidades_servicos^2), data = base_new, nvmax = 18)

melhores_modelos <- summary(subset_modelo)

# Identificar o modelo com menor BIC
melhor_modelo <- which.min(melhores_modelos$bic)

# Tabela com os modelos e estatísticas de ajuste
nvmax = 17
tabela_modelos <- data.frame(
  Modelos = sapply(1:nvmax, function(i) {
    if (i <= length(melhores_modelos$which))
      paste0(names(melhores_modelos$which)[i], collapse = ", ")
    else
      NA
  }),
  CP = melhores_modelos$cp,
  RSQ = melhores_modelos$rsq,
  ADJR2 = melhores_modelos$adjr2,
  BIC = melhores_modelos$bic
)


tabela_modelos
```

```{r}
#| fig-height: 5
#| label: fig-ajuste-modelos
#| fig-cap: Gráficos de R², R² ajustado, Cp de Mallows e BIC.

## gráficos de r2, r2 ajustado, cp e bic ----
n_parametros<-as.numeric(rownames(summary(subset_modelo)$which))+1
par(mfrow = c(2, 2))

plot_r2 <- plot(n_parametros, melhores_modelos$rsq,xlab="N° de parâmetros",ylab="R Quadrado")

plot_r2ajustado <- plot(n_parametros,melhores_modelos$adjr2,xlab="N° de parâmetros",ylab="R Quadrado Ajustado")

plot_cp <- plot(n_parametros,melhores_modelos$cp,xlab="N° de parâmetros",ylab="Cp de Mallows")

plot_bic <- plot(n_parametros,melhores_modelos$bic,xlab="N° de parâmetros",ylab="BIC")

```

Como se pode ver na [Figura @fig-ajuste-modelos], ao analisar o crescimento nos níveis dos gráficos em relação ao $R^{2}$, $R^{2}$ ajustado, Critério de Pressão de Mallows (Cp) e Critério de Informação Bayesiano (BIC) até 6 parâmetros, observa-se um aumento em ambos os indicadores até atingir esse ponto. Contudo, ao aplicar métodos de seleção de variáveis, como o *Backward* e o *Stepwise*, é escolhido o modelo que mantém 7 parâmetros, enquanto no método *Forward*, nenhuma variável é removida. Diante dessa divergência, optou-se por trabalhar com dois modelos distintos, buscando determinar qual deles melhor atende aos objetivos específicos do trabalho.

Na análise dos modelos de regressão escolhidos, destaca-se o Modelo com 5 Variáveis, que incorpora as características de idade, risco de infecção, regiaoW, facilidades e servicos disponíveis e interaçao da regiaoS com o número de enfermeiros. Expresso pela equação:

$$
 Y_{i}= \beta _{0}+\beta _{1}X_{2}+\beta _{2}X_{3}+\beta _{3}X_{10}+\beta _{4}X_{13}+\beta _{5}X_{9}X_{12}+\varepsilon_{i}
$$


Além disso, o Modelo com 6 Variáveis expande a abordagem ao incorporar as variáveis de idade, risco de infecção, regiaoW, termo quadrático de facilidades e servicos disponíveis, interação entre regiaoNC e número de enfermeiros e interação entre a regiaoS e número de enfermeiros. A equação do modelo é expressa por:

$$
 Y_{i}= \beta _{0}+\beta _{1}X_{2}+\beta _{2}X_{3}+\beta _{3}X_{10}+\beta _{4}X_{13}^{2}+\beta _{5}X_{8}X_{12}+\beta _{6}X_{9}X_{12}+\varepsilon_{i}
$$



```{r}
# modelos escolhidos-----

# base modelos escolhidos
base_mods <- base

library(dplyr)

# Adicione variáveis dummy para a variável qualitativa escola_medicina
base_mods <- base_mods %>%
  mutate(escola_medicinaSim = ifelse(escola_medicina == 1, 1, 0),
         escola_medicinaNao = ifelse(escola_medicina == 2, 1, 0))

# Adicione variáveis dummy para a variável qualitativa regiao
base_mods <- base_mods %>%
  mutate(regiaoNE = ifelse(regiao == 1, 1, 0),
         regiaoNC = ifelse(regiao == 2, 1, 0),
         regiaoS = ifelse(regiao == 3, 1, 0),
         regiaoW = ifelse(regiao == 4, 1, 0))


modelo_select1 <- lm(t_internacao~idade + r_infeccao + regiaoW + 
                       facilidades_servicos+ regiaoS*enfermeiros,
                     data = base_mods)
# summary(modelo_select1)

modelo_select2 <- lm(t_internacao~ idade+ r_infeccao +regiaoW+
                       I(facilidades_servicos^2)+ regiaoNC*enfermeiros+
                       regiaoS*enfermeiros, data = base_mods)
# summary(modelo_select2)



```


Ambos os modelos estão representados na [Tabela @tbl-reg-modelo-teste]. O Modelo 1 apresenta um coeficiente de determinação de `r format(round(summary(modelo_select1)$r.squared, digits = 4), decimal.mark = ",")`, enquanto o Modelo 2 apresenta um coeficiente de determinação de `r format(round(summary(modelo_select2)$r.squared, digits = 4), decimal.mark = ",")`. Esses resultados indicam que o Modelo 1 explica `r format(round(summary(modelo_select1)$r.squared * 100, digits = 2), decimal.mark = ",")`% da variabilidade na duração da internação, enquanto o Modelo 2 explica `r format(round(summary(modelo_select2)$r.squared * 100, digits = 2), decimal.mark = ",")`% da variabilidade na duração da internação. Assim, o Modelo 1 parece ser mais parcimonioso, pois explica uma proporção maior da variabilidade na duração da internação com menos variáveis.

```{r}

```{r}
#| output: asis
#| label: tbl-reg-modelo-teste
#| tbl-cap: Estatísticas dos Modelos 1 e 2.

stargazer(modelo_select1,
          modelo_select2,
          column.labels=c("Modelo 1","Modelo 2"),
          model.numbers = FALSE,
          single.row=TRUE,
          report=("vc*p"),
          header = FALSE
          )

```


```{r}
#| label: fig-ajuste-modelos-1
#| fig-cap: Gráfico de Distribuição de Probabilidade Normal do Modelo 1.

# análise dos pressupostos dos modelos selecionados----

# normalidade----
shapiro_modelo1 <- shapiro.test(modelo_select1$residuals)$p.value
shapiro_modelo2 <- shapiro.test(modelo_select2$residuals)$p.value

qqplot.data(modelo_select1$residuals, "Resíduos")

```

```{r}
#| label: fig-ajuste-modelos-2
#| fig-cap: Gráfico de Distribuição de Probabilidade Normal do Modelo 2.
qqplot.data(modelo_select2$residuals, "Resíduos")
```

```{r}
#| fig-height: 5.5
#| label: fig-independencia
#| fig-cap: Gráficos de Resíduos e Resíduos Studentizados vs Valores Ajustados dos Modelos 1 e 2.

# homogeneidade breush pagan-----
bp_modelo1 <- bptest(modelo_select1)
bp_modelo2 <- bptest(modelo_select2)

# residuos studentzados 
stud1 <- rstudent(modelo_select1)
stud2 <- rstudent(modelo_select2)

# gráficos----
par(mfrow=c(2,2))
plot(modelo_select1$fitted.values, modelo_select1$residuals, xlab = "Valores ajustados",ylab = "Resísuos")
#title("Gráfico de Resíduos do Modelo 1")
plot(modelo_select1$fitted.values, stud1,xlab = "Valores ajustados",ylab = "Resísuo Studentizado")
#abline(h=0)
#title("Gráfico de Resíduo Studentizado do Modelo 1")
plot(modelo_select2$fitted.values, modelo_select2$residuals,xlab = "Valores ajustados",ylab = "Resísuos")
#title("Gráfico de Resíduos do Modelo 2")
plot(modelo_select2$fitted.values, stud2,xlab = "Valores ajustados",ylab = "Resísuo Studentizado")
#abline(h=0)
#title("Gráfico de Resíduo Studentizado do Modelo 2")

```


Os testes de normalidade também podem ser realizados. O teste de Shapiro-Wilk para o modelo 1 não rejeitou a hipótese nula de não normalidade, com p-valor de `r format(round(shapiro_modelo1, digits = 4), decimal.mark = ",")`. O teste de Shapiro-Wilk para o modelo 2 também não rejeitou a hipótese nula de não normalidade, com p-valor de `r format(round(shapiro_modelo2, digits = 4), decimal.mark = ",")`. Além disso, os gráficos de resíduos e resíduos studentizados para ambos os modelos não apresentam padrões claros, sugerindo que os resíduos podem ser considerados normalmente distribuídos,  como se pode ver nas Figuras [-@fig-ajuste-modelos-1] e [-@fig-ajuste-modelos-2].

Com respeito à homogeneidade da variância, o teste de Breusch-Pagan para o modelo 1 não rejeitou a hipótese nula de homogeneidade, com p-valor de `r format(round(bp_modelo1$p.value, digits = 4), decimal.mark = ",")`. O teste de Breusch-Pagan para o modelo 2 também não rejeitou a hipótese nula de homogeneidade, com p-valor de `r format(round(bp_modelo2$p.value, digits = 4), decimal.mark = ",")`. Conclusões semelhantes podem ser visualizadas na [Figura @fig-independencia].





```{r}

## Teste linear geral----
# H0: modelo reduzido
# H1: modelo completo
# com nivel de 5% de significanca NAO rejeita H0
resultado_teste1 <- anova(modelo_select1, modelo_combinado)

resultado_teste2 <- anova(modelo_select2, modelo_combinado)

## Multicolinearidade ----
# calculo do vif

vif<-vif(modelo_select1)
vif_modelo1 <- mean(vif)

vif<-vif(modelo_select2)
vif_modelo2 <- mean(vif)
```

Com base apenas na avaliação da multicolinearidade, o modelo 1 pode ser considerado um pouco mais robusto em relação a esse aspecto, apresentando uma média (`r format(round(vif_modelo1, digits = 4), decimal.mark = ",")`) de VIF (Fator de Inflação da Variância) inferior em comparação com o modelo 2 (`r format(round(vif_modelo2, digits = 4), decimal.mark = ",")`). 

Além disso, os resultados dos testes lineares gerais entre os modelos reduzidos e completos indicam que a inclusão das variáveis adicionais não resulta em uma melhoria estatisticamente significativa na explicação do tempo de internação para ambos os modelos selecionados. 

Em ambas as comparações, o p-valor associado ao teste F é maior que o nível de significância de 5%, levando à não rejeição da hipótese nula ($H_0$) de que o modelo reduzido é suficiente. Assim, considerando a robustez em relação à multicolinearidade, evidenciada pela média de VIF, e a adequação estatística dos modelos, optou-se por escolher o modelo 1 como a abordagem mais parcimoniosa para explicar a variabilidade no tempo de internação. Diante disso, inicia-se a análise do modelo a partir da [Figura @fig-correlograma], que apresenta seu correlograma.



```{r}
#| fig-height: 6.5
#| label: fig-correlograma
#| fig-cap: Correlograma do Modelo 1.

# #correlograma do modelo escolhido MODELO 1----
dados_correlograma <- base_mods %>% dplyr::select(c(t_internacao, r_infeccao, regiaoW,
                                                facilidades_servicos, regiaoS, enfermeiros))

dados_correlograma$t_internacao <- log(dados_correlograma$t_internacao)



ggpairs(
  dados_correlograma, axisLabels="none",
  lower = list(continuous = wrap("points", alpha = 0.7, size=0.8), 
               combo = wrap("dot", alpha = 0.4, size=0.4)),
) 

```

## Valores Influentes

Na presente seção, foram adotadas medidas destinadas a ressaltar a influência de observações individuais nos parâmetros do modelo. As métricas utilizadas compreendem DFBetas, DFFits, *Cook's Distance*, *Leverage* e *Influence Total*.

```{r}
#| label: fig-dffits
#| fig-cap: Gráficos de DFFits e Hii.
#| fig-height: 3

## Medidas de Influencia ----
### Dffits ----
## 
indice <- c(1:60)
dffits <- abs(dffits(modelo_select1))

par(mfrow=c(1, 2))
plot(indice,dffits, type = "l")
abline(h = 1, lty = 2)


### hii ----
p <- length(coef(modelo_select1))
n <- nrow(base_mods)


hii <- hatvalues(modelo_select1)
plot(indice,hii,type="l") 
abline(h=2*p/n)
```


```{r}
#| fig-height: 6
#| label: fig-DFBetas
#| fig-cap: Gráficos de DFBetas e DFBetas Studentizados.

### DFBEtas ----
dfbetaPlots(modelo_select1) 

```


```{r}
#| label: fig-cooks-distance
#| fig-cap: Gráfico de Cook's Distance.

### DCOOK ----
dcook <- cooks.distance(modelo_select1)
indice_max_cook <- which.max(dcook)
plot(indice,dcook, type = "l")
points(indice[indice_max_cook], dcook[indice_max_cook], col = "red", pch = 16)
text(indice[indice_max_cook], dcook[indice_max_cook], 
     labels = sprintf("Índice %d\nCook's D: %.3f", indice[indice_max_cook], 
                      dcook[indice_max_cook]), pos = 4, col = "red", cex = 0.8)
```


Os resultados indicam que algumas observações exercem influência substancial sobre o modelo. As observações de número 6, 35, 36, 38, 47 e 50 demonstraram um impacto significativo em diversas variáveis, evidenciando influência em diferentes aspectos do modelo. Por exemplo, a observação 6 revelou um efeito significativo nas variáveis idade e facilidades e servicos disponíveis.

No que diz respeito à DFFits ([Figura @fig-dffits]), destaca-se a observção 6, indicando uma influência considerável sobre a estimativa ajustada da resposta. Analisando Cook's Distance ([Figura @fig-cooks-distance]), observou-se que as observações 6, 38 e outras se destacaram, sugerindo uma influência global no modelo. Essas observações podem ter um impacto desproporcional nas estimativas do modelo.



```{r}
#| label: fig-leverage
#| fig-cap: Gráfico de Leverage (Hat).

### PRESS ----
medinflu<-influence.measures(modelo_select1)
PRESS <-modelo_select1$residuals/(1-medinflu$infmat[,12]) 
# rstandard(modelo_select1,type="predictive")
PRESS_medida <- sum((rstandard(modelo_select1,type = "predictive"))^2)
plot(indice,PRESS, type = "l")


```


No contexto da avaliação de Leverage (*Hat*), as observações 6 e 38 foram identificadas com valores elevados, indicando que estão "distantes" das demais em termos das variáveis independentes. Isto pode ser observado na [Figura @fig-leverage]. 

Finalmente, ao avaliar a Influence Total, observações 6, 7, 28 e 38 foram identificadas como globalmente influentes, destacando a necessidade de uma análise mais aprofundada desses pontos específicos.


```{r}
#| output: asis
#| label: tbl-modelo-validacao
#| tbl-cap: Estatísticas do Modelo de Validação.

# Amostra de validação----
valid <- readxl::read_xlsx("dados_validação.xlsx")


# Adicione variáveis dummy para a variável qualitativa escola_medicina
valid <- valid %>%
  mutate(escola_medicinaSim = ifelse(escola_medicina == 1, 1, 0),
         escola_medicinaNao = ifelse(escola_medicina == 2, 1, 0))

# Adicione variáveis dummy para a variável qualitativa regiao
valid <- valid %>%
  mutate(regiaoNE = ifelse(regiao == 1, 1, 0),
         regiaoNC = ifelse(regiao == 2, 1, 0),
         regiaoS = ifelse(regiao == 3, 1, 0),
         regiaoW = ifelse(regiao == 4, 1, 0))


modelo_validacao <- lm(t_internacao~idade + r_infeccao + regiaoW + 
                                           facilidades_servicos+ regiaoS*enfermeiros,
                                         data = valid)
# summary(modelo_validacao)
# aov(modelo_validacao)
# anova(modelo_validacao)
# anova(modelo_select1)

names(banco) <- c("id","t_internacao","idade","r_infeccao",
"prop_culturas", "prop_raiox", "leitos", "escola_medicina", "regiao", "m_dia_pacientes", "enfermeiros", "facilidades_servicos")


# teste do modelo no banco de dados completo-----
base_dado <- banco

library(dplyr)

# Adicione variáveis dummy para a variável qualitativa escola_medicina
base_dado <- base_dado %>%
  mutate(escola_medicinaSim = ifelse(escola_medicina == 1, 1, 0),
         escola_medicinaNao = ifelse(escola_medicina == 2, 1, 0))

# Adicione variáveis dummy para a variável qualitativa regiao
base_dado <- base_dado %>%
  mutate(regiaoNE = ifelse(regiao == 1, 1, 0),
         regiaoNC = ifelse(regiao == 2, 1, 0),
         regiaoS = ifelse(regiao == 3, 1, 0),
         regiaoW = ifelse(regiao == 4, 1, 0))

modelo_select1_dado <- lm(t_internacao~idade + r_infeccao + regiaoW + 
                       facilidades_servicos+ regiaoS*enfermeiros,
                     data = base_dado)


stargazer(modelo_select1,
          modelo_validacao,
          modelo_select1_dado,
          column.labels=c("Modelo de treinamento", "Modelo de validação", "Modelo completo"),
          model.numbers = FALSE,
          single.row=TRUE,
          report=("vc*p"),
          header = FALSE
          )



```


```{r}

## MSPR----
previstos <- predict(modelo_select1)[1:53]
# Calcular o MSPR
mspr <- mean((previstos - valid$t_internacao)^2)





#R2 validação
SS_res_val <- sum(modelo_validacao$residuals^2)
SS_tot_val <- sum((valid$t_internacao - mean(valid$t_internacao))^2)
R2_val <- 1 - SS_res_val / SS_tot_val
# R2_val
# MSE validação
n_val <- length(valid$t_internacao)
MSE_val <- sum((modelo_validacao$residuals)^2) / n
# MSE_val

# r2 modelo_select1
SS_res_mod <- sum(modelo_select1$residuals^2)
SS_tot_mod <- sum((base_mods$t_internacao - mean(base_mods$t_internacao))^2)
R2_mod <- 1 - SS_res_mod / SS_tot_mod

# MSE modelo_select
n_mod <- length(base_mods$t_internacao)
MSE_mod <- sum((modelo_select1$residuals)^2) / n




# Predições no conjunto de validação-----
predicoes_validacao <- predict(modelo_select1, newdata = valid)

# R²
SS_res_val <- sum((valid$t_internacao - predicoes_validacao)^2)
SS_tot_val <- sum((valid$t_internacao - mean(valid$t_internacao))^2)
R2_val <- 1 - SS_res_val / SS_tot_val

# MSE
n_val <- nrow(valid)
MSE_val <- sum((valid$t_internacao - predicoes_validacao)^2) / n_val

# Exibindo os resultados
# cat("R² no conjunto de validação:", R2_val, "\n")
# cat("MSE no conjunto de validação:", MSE_val, "\n")

```







## Validação



O MSPR (Mean Squared Prediction Error ou Erro Quadrático Médio de Previsão) é uma métrica essencial para avaliar a precisão das previsões de um modelo. Neste estudo, o MSPR calculado para o modelo 1 selecionado no conjunto de validação foi de `r format(round(mspr, digits = 4), decimal.mark = ",")`. Quanto menor o valor do MSPR, melhor o desempenho do modelo em realizar previsões precisas. Essa métrica representa a média dos quadrados dos erros de previsão para as observações na amostra de validação.

As métricas de desempenho do modelo selecionado foram analisadas nos conjuntos de treinamento e validação. No treinamento, o modelo apresentou um R² de `r format(round(R2_mod, digits = 4), decimal.mark = ",")` e um MSE de `r format(round(MSE_mod, digits = 4), decimal.mark = ",")` \textcolor{red}{1.0011}, indicando um ajuste relativamente bom aos dados. Na validação, o R² foi de aproximadamente `r format(round(summary(modelo_validacao)$r.squared, digits = 4), decimal.mark = ",")` e o MSE foi de cerca de `r format(round(MSE_val, digits = 4), decimal.mark = ",")`. Essas métricas fornecem uma avaliação do ajuste do modelo aos dados, sendo desejáveis valores mais altos de R² e mais baixos de MSE.

Essas métricas são fundamentais para avaliar o desempenho do modelo, fornecendo insights valiosos para possíveis ajustes e melhorias.


Ao aplicar o modelo reduzido ao conjunto de dados completo, os resultados revelam um R² ajustado de 0,4564, indicando que possui a capacidade de explicar aproximadamente 45,64% da variabilidade observada no tempo de internação. Esse valor, considerado moderado, sugere uma razoável capacidade de adaptação do modelo às complexidades dos dados abrangentes.




